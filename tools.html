<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦ç”¨å·¥å…· - 2026 äº¬éƒ½å…«æ—¥éŠ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .route-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
        }
        /* è‡ªå®šç¾© Checkbox æ¨£å¼ */
        .checklist-item input:checked + span {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .speak-btn:active {
            transform: scale(0.95);
        }
        /* éŒ„éŸ³ä¸­çš„å‹•ç•«æ•ˆæœ */
        .listening-ring {
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            animation: ring-pulse 1.5s infinite;
        }
        @keyframes ring-pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
    </style>
</head>
<body class="p-0 sm:p-6">
    <!-- Navigation Bar -->
    <div class="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-md mb-6 py-2 overflow-x-auto">
        <div class="flex space-x-2 px-4 whitespace-nowrap">
            <a href="index.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">ç¸½è¦½</a>
            <!-- Active Link -->
            <a href="tools.html" class="px-3 py-1 text-sm font-semibold rounded-full bg-purple-600 text-white shadow-lg transition duration-150">å¯¦ç”¨å·¥å…·</a>
            <a href="day_1_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 1</a>
            <a href="day_2_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 2</a>
            <a href="day_3_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 3</a>
            <a href="day_4_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 4</a>
            <a href="day_5_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 5</a>
            <a href="day_6_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 6</a>
            <a href="day_7_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 7</a>
            <a href="day_8_itinerary.html" class="px-3 py-1 text-sm font-medium rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150">Day 8</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-xl mx-auto px-4 sm:px-0">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
                <span class="mr-2">ğŸ§°</span> å¯¦ç”¨å·¥å…·ç®±
            </h1>
            <h2 class="text-xl text-gray-600 mt-1">
                ç·Šæ€¥æ‡‰è®Šã€èªè¨€æºé€šèˆ‡è¡Œææª¢æŸ¥
            </h2>
        </header>

        <!-- 1. å®‰å…¨èˆ‡ç·Šæ€¥æ‡‰è®Š -->
        <div class="route-card bg-red-100 border-t-4 border-red-600">
            <h3 class="text-2xl font-semibold text-red-800 mb-4 flex items-center">
                <span class="mr-2">ğŸ†˜</span> å®‰å…¨èˆ‡ç·Šæ€¥æ‡‰è®Š
            </h3>
            
            <div class="grid grid-cols-1 gap-4">
                <!-- ç·Šæ€¥è¯çµ¡å¡ -->
                <div class="bg-white p-4 rounded-lg shadow border border-red-200">
                    <h4 class="text-lg font-bold text-gray-800 mb-3 border-b pb-1">ğŸ“ ç·Šæ€¥è¯çµ¡é›»è©±</h4>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-center justify-between">
                            <span>ğŸ‘® è­¦å¯Ÿ (å ±æ¡ˆ)</span>
                            <a href="tel:110" class="font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">110</a>
                        </li>
                        <li class="flex items-center justify-between">
                            <span>ğŸš‘ æ•‘è­·è»Š/ç«è­¦</span>
                            <a href="tel:119" class="font-bold text-red-600 bg-red-50 px-3 py-1 rounded-full">119</a>
                        </li>
                        <li class="flex items-center justify-between">
                            <span>ğŸŒŠ æµ·ä¸Šä¿å®‰å»³</span>
                            <a href="tel:118" class="font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">118</a>
                        </li>
                    </ul>
                    <div class="mt-4 pt-3 border-t border-gray-100">
                        <p class="text-sm font-bold text-gray-800 mb-1">ğŸ‡¹ğŸ‡¼ å°åŒ—é§å¤§é˜ªç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•</p>
                        <p class="text-xs text-gray-500 mb-1">æ€¥é›£æ•‘åŠ©é›»è©± (å°ˆä¾›ç·Šæ€¥æ±‚åŠ©ä¹‹ç”¨)</p>
                        <a href="tel:+81-90-8794-4568" class="block w-full text-center font-bold text-white bg-red-600 py-2 rounded-lg hover:bg-red-700 transition">
                            +81-90-8794-4568
                        </a>
                    </div>
                </div>

                <!-- å°±é†«æŒ‡å¼• -->
                <div class="bg-white p-4 rounded-lg shadow border border-blue-200">
                    <h4 class="text-lg font-bold text-gray-800 mb-3 border-b pb-1">ğŸ¥ äº¬éƒ½å¤–èªå°æ‡‰æ€¥è¨º</h4>
                    <ul class="space-y-4 text-gray-700">
                        <li>
                            <p class="font-bold text-blue-800">äº¬éƒ½å¤§å­¸é†«å­¸éƒ¨é™„å±¬é†«é™¢</p>
                            <a href="https://maps.app.goo.gl/8jZ1Xy7z1y1z1z1z1" target="_blank" class="text-xs text-blue-500 hover:underline">ğŸ“ å·¦äº¬å€è–è­·é™¢å·åŸç”º54</a>
                            <a href="tel:+81-75-751-3111" class="block text-sm font-bold text-gray-800 mt-1">ğŸ“ 075-751-3111</a>
                        </li>
                        <li>
                            <p class="font-bold text-blue-800">äº¬éƒ½ç¬¬ä¸€èµ¤åå­—é†«é™¢</p>
                            <a href="https://maps.app.goo.gl/8jZ1Xy7z1y1z1z1z1" target="_blank" class="text-xs text-blue-500 hover:underline">ğŸ“ æ±å±±å€æœ¬ç”º15-749</a>
                            <a href="tel:+81-75-561-1121" class="block text-sm font-bold text-gray-800 mt-1">ğŸ“ 075-561-1121</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 2. å¯¦ç”¨æ—…éŠæ—¥èªæŒ‡æŒ‡é€š (ç¿»è­¯å‡ç´šç‰ˆ) -->
        <div class="route-card bg-purple-50 border-t-4 border-purple-500">
            <h3 class="text-2xl font-semibold text-purple-800 mb-4 flex items-center">
                <span class="mr-2">ğŸ—£ï¸</span> æ—¥èªæŒ‡æŒ‡é€š (ä¸­æ—¥ç¿»è­¯ + èªéŸ³)
            </h3>
            
            <!-- Translation Input Area -->
            <div class="mb-6 bg-white p-4 rounded-lg shadow border border-purple-200">
                <label for="custom-text" class="block text-sm font-bold text-gray-700 mb-2">âœï¸ è¼¸å…¥æˆ–èªªå‡ºä¸­æ–‡ (è‡ªå‹•ç¿»æˆæ—¥æ–‡)</label>
                
                <div class="flex space-x-2 mb-2">
                    <input type="text" id="custom-text" placeholder="ä¾‹å¦‚ï¼šé€™é™„è¿‘æœ‰æ¨è–¦çš„é¤å»³å—ï¼Ÿ" class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <!-- Mic Button -->
                    <button id="mic-btn" onclick="startListening()" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-md hover:bg-gray-300 transition flex items-center justify-center" title="èªéŸ³è¼¸å…¥">
                        <span class="text-xl">ğŸ™ï¸</span>
                    </button>
                </div>

                <!-- Translation Button -->
                <button onclick="handleTranslateAndSpeak()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-bold hover:bg-purple-700 transition mb-3 flex justify-center items-center">
                    <span class="mr-2">ğŸ”„</span> ç¿»è­¯ä¸¦æ’­æ”¾æ—¥èª
                </button>

                <!-- Result Display -->
                <div id="translation-result" class="hidden bg-gray-50 rounded-md p-3 border border-gray-200">
                    <p class="text-xs text-gray-500 mb-1">ç¿»è­¯çµæœ (æ—¥æ–‡)ï¼š</p>
                    <p id="translated-text" class="text-lg font-bold text-purple-800 mb-2">...</p>
                    <p class="text-xs text-gray-500 mb-1">åŸæ–‡ (ä¸­æ–‡)ï¼š</p>
                    <p id="original-text" class="text-sm text-gray-700">...</p>
                    
                    <div class="mt-3 flex justify-end">
                        <button onclick="speakTranslated()" class="bg-purple-100 text-purple-700 px-3 py-1 rounded text-xs font-bold hover:bg-purple-200 flex items-center">
                            <span class="mr-1">ğŸ”Š</span> å†è½ä¸€æ¬¡
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-3">
                <!-- Group: Basic -->
                <div class="space-y-2">
                    <h4 class="text-sm font-bold text-gray-500 uppercase border-b pb-1">åŸºæœ¬ç”¨èª</h4>
                    <button onclick="speak('ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</div>
                            <div class="text-xs text-gray-500 font-medium">Arigato gozaimasu (è¬è¬)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                    <button onclick="speak('ã™ã¿ã¾ã›ã‚“')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ã™ã¿ã¾ã›ã‚“</div>
                            <div class="text-xs text-gray-500 font-medium">Sumimasen (ä¸å¥½æ„æ€ / è«‹å•)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                </div>

                <!-- Group: Dining -->
                <div class="space-y-2 mt-2">
                    <h4 class="text-sm font-bold text-gray-500 uppercase border-b pb-1">é¤å»³ç”¨é¤</h4>
                    <button onclick="speak('ã“ã‚Œã‚’ãã ã•ã„')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ã“ã‚Œã‚’ãã ã•ã„</div>
                            <div class="text-xs text-gray-500 font-medium">Kore o kudasai (è«‹çµ¦æˆ‘é€™å€‹)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                    <button onclick="speak('ãŠæ°´ã‚’ãã ã•ã„')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ãŠæ°´ã‚’ãã ã•ã„</div>
                            <div class="text-xs text-gray-500 font-medium">Omizu o kudasai (è«‹çµ¦æˆ‘å†°æ°´)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                    <button onclick="speak('ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™</div>
                            <div class="text-xs text-gray-500 font-medium">Okaikei o onegaishimasu (è«‹çµå¸³)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                    <button onclick="speak('ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹</div>
                            <div class="text-xs text-gray-500 font-medium">Toire wa doko desuka (è«‹å•å»æ‰€åœ¨å“ªè£¡ï¼Ÿ)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                    <button onclick="speak('ãƒã‚®æŠœãã§ãŠé¡˜ã„ã—ã¾ã™')" class="speak-btn w-full bg-white p-3 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 border border-gray-200">
                        <div class="text-left">
                            <div class="text-lg font-bold text-gray-800">ãƒã‚®æŠœãã§ãŠé¡˜ã„ã—ã¾ã™</div>
                            <div class="text-xs text-gray-500 font-medium">Negi nuki de onegaishimasu (è«‹ä¸è¦åŠ è”¥)</div>
                        </div>
                        <span class="text-2xl text-purple-500">ğŸ”Š</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 3. äº’å‹•æª¢æŸ¥æ¸…å–® -->
        <div class="route-card bg-green-50 border-t-4 border-green-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-semibold text-green-800 flex items-center">
                    <span class="mr-2">âœ…</span> è¡Œææª¢æŸ¥æ¸…å–®
                </h3>
                <button onclick="resetChecklist()" class="text-xs text-red-500 underline">é‡ç½®æ¸…å–®</button>
            </div>
            <p class="text-sm text-gray-600 mb-4">å‹¾é¸ç‹€æ…‹æœƒè‡ªå‹•å„²å­˜ï¼Œé—œé–‰ç¶²é å¾Œä¸æœƒæ¶ˆå¤±ã€‚</p>

            <div class="space-y-4">
                <!-- è­‰ä»¶éŒ¢åŒ… -->
                <div>
                    <h4 class="font-bold text-green-700 mb-2">é‡è¦è­‰ä»¶</h4>
                    <div class="bg-white rounded-lg shadow p-3 space-y-2">
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="pass">
                            <span class="text-gray-800">è­·ç…§ (æœ‰æ•ˆæœŸé™å…§)</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="cash">
                            <span class="text-gray-800">æ—¥å¹£ç¾é‡‘ / ä¿¡ç”¨å¡</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="sim">
                            <span class="text-gray-800">SIM å¡ / WiFi æ©Ÿ</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="visit-web">
                            <span class="text-gray-800">Visit Japan Web æˆªåœ–</span>
                        </label>
                    </div>
                </div>

                <!-- é›»å­ç”¢å“ -->
                <div>
                    <h4 class="font-bold text-green-700 mb-2">é›»å­ç”¢å“</h4>
                    <div class="bg-white rounded-lg shadow p-3 space-y-2">
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="phone">
                            <span class="text-gray-800">æ‰‹æ©Ÿ & å……é›»ç·š</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="powerbank">
                            <span class="text-gray-800">è¡Œå‹•é›»æº (éœ€éš¨èº«æ”œå¸¶)</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="adapter">
                            <span class="text-gray-800">è½‰æ¥é ­ (æ—¥æœ¬é›»å£“100Vï¼Œæ’åº§åŒå°ç£)</span>
                        </label>
                    </div>
                </div>

                <!-- ç”Ÿæ´»ç”¨å“ -->
                <div>
                    <h4 class="font-bold text-green-700 mb-2">ç”Ÿæ´»ç”¨å“</h4>
                    <div class="bg-white rounded-lg shadow p-3 space-y-2">
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="meds">
                            <span class="text-gray-800">å¸¸å‚™è—¥å“ (æ„Ÿå†’/è…¸èƒƒ/æ­¢ç—›)</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="clothes">
                            <span class="text-gray-800">æ›æ´—è¡£ç‰© (æ´‹è”¥å¼ç©¿æ­)</span>
                        </label>
                        <label class="checklist-item flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-green-600 rounded focus:ring-green-500" data-id="umbrella">
                            <span class="text-gray-800">æ‘ºç–Šå‚˜ (æ—¥æœ¬å†¬å¤©å¸¸æœ‰é›¨é›ª)</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let jaMaleVoice = null;

        // --- Voice Loading Logic (Prioritize Male) ---
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            const jaVoices = voices.filter(v => v.lang.toLowerCase().includes('ja'));
            const maleKeywords = ['otoya', 'ichiro', 'takumi', 'hattori', 'male', 'men'];
            
            jaMaleVoice = jaVoices.find(voice => {
                const name = voice.name.toLowerCase();
                return maleKeywords.some(k => name.includes(k));
            });
        }

        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
            loadVoices();
        }

        // --- Text-to-Speech Function ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP';
                utterance.rate = 0.9;

                if (!jaMaleVoice) loadVoices();
                if (jaMaleVoice) {
                    utterance.voice = jaMaleVoice;
                }

                window.speechSynthesis.speak(utterance);
            } else {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­æ”¾åŠŸèƒ½ã€‚');
            }
        }

        // --- Translation & Speech Recognition Logic ---
        let currentTranslatedText = "";

        // 1. Speech Recognition (Web Speech API)
        function startListening() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½ (è«‹ä½¿ç”¨ Chrome æˆ– Safari)ã€‚');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'zh-TW'; // è¨­å®šè¼¸å…¥èªè¨€ç‚ºç¹é«”ä¸­æ–‡
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            const micBtn = document.getElementById('mic-btn');
            const inputField = document.getElementById('custom-text');

            recognition.onstart = function() {
                micBtn.classList.add('listening-ring', 'bg-red-100', 'text-red-600');
                inputField.placeholder = "è«‹èªªè©±...";
            };

            recognition.onend = function() {
                micBtn.classList.remove('listening-ring', 'bg-red-100', 'text-red-600');
                inputField.placeholder = "ä¾‹å¦‚ï¼šé€™é™„è¿‘æœ‰æ¨è–¦çš„é¤å»³å—ï¼Ÿ";
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                inputField.value = transcript;
                // è‡ªå‹•è§¸ç™¼ç¿»è­¯
                handleTranslateAndSpeak();
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                alert('ç„¡æ³•è¾¨è­˜èªéŸ³ï¼Œè«‹é‡è©¦æˆ–æª¢æŸ¥éº¥å…‹é¢¨æ¬Šé™ã€‚');
            };

            recognition.start();
        }

        // 2. Translation Function (Using Google Translate unofficial API)
        async function handleTranslateAndSpeak() {
            const inputText = document.getElementById('custom-text').value;
            if (!inputText.trim()) {
                alert('è«‹å…ˆè¼¸å…¥æˆ–èªªå‡ºè¦ç¿»è­¯çš„ä¸­æ–‡ã€‚');
                return;
            }

            // é¡¯ç¤ºè¼‰å…¥ä¸­ç‹€æ…‹
            const resultDiv = document.getElementById('translation-result');
            const translatedTextEl = document.getElementById('translated-text');
            const originalTextEl = document.getElementById('original-text');
            
            resultDiv.classList.remove('hidden');
            translatedTextEl.textContent = "ç¿»è­¯ä¸­...";
            originalTextEl.textContent = inputText;

            try {
                // ä½¿ç”¨å…¬é–‹çš„ Google Translate API æ¥å£ (é€é CORS Proxy)
                const apiUrl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-TW&tl=ja&dt=t&q=${encodeURIComponent(inputText)}`;
                // æ³¨æ„ï¼šç›´æ¥å‘¼å«å¯èƒ½æœƒé‡åˆ° CORS å•é¡Œï¼Œé€™è£¡ä½¿ç”¨ corsproxy.io
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`;

                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Translation API Error');
                
                const data = await response.json();
                // Google Translate API å›å‚³çµæ§‹: [[["æ—¥æ–‡çµæœ", "ä¸­æ–‡åŸæ–‡", ...]], ...]
                const translatedText = data[0][0][0];

                // æ›´æ–° UI
                currentTranslatedText = translatedText;
                translatedTextEl.textContent = currentTranslatedText;
                
                // è‡ªå‹•æ’­æ”¾èªéŸ³
                speak(currentTranslatedText);

            } catch (error) {
                console.error('Translation failed:', error);
                translatedTextEl.textContent = "ç¿»è­¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ‰‹å‹•è¼¸å…¥ã€‚";
                // Fallback: å¦‚æœç¿»è­¯å¤±æ•—ï¼Œå˜—è©¦ç›´æ¥æœ—è®€è¼¸å…¥çš„æ–‡å­—(å‡è¨­ä½¿ç”¨è€…è¼¸å…¥äº†æ—¥æ–‡)
                currentTranslatedText = inputText;
            }
        }

        function speakTranslated() {
            if (currentTranslatedText) {
                speak(currentTranslatedText);
            }
        }

        function speakCustom() {
            // ä¿ç•™èˆŠæœ‰åŠŸèƒ½ï¼Œç›´æ¥æ’­æ”¾è¼¸å…¥æ¡†å…§å®¹
            const text = document.getElementById('custom-text').value;
            if (text.trim() !== "") {
                speak(text);
            }
        }

        // --- Interactive Checklist Function (LocalStorage) ---
        document.addEventListener('DOMContentLoaded', () => {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
            
            // Load saved state
            checkboxes.forEach(box => {
                const id = box.getAttribute('data-id');
                const saved = localStorage.getItem('checklist_' + id);
                if (saved === 'true') {
                    box.checked = true;
                }
                
                // Add change listener
                box.addEventListener('change', (e) => {
                    localStorage.setItem('checklist_' + id, e.target.checked);
                });
            });
        });

        function resetChecklist() {
            if(confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å‹¾é¸é …ç›®å—ï¼Ÿ')) {
                const checkboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
                checkboxes.forEach(box => {
                    box.checked = false;
                    const id = box.getAttribute('data-id');
                    localStorage.removeItem('checklist_' + id);
                });
            }
        }
    </script>
</body>
</html>